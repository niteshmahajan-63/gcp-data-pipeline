truncate table `sync_ctas.billing_items_ctasp`;

insert into  `sync_ctas.billing_items_ctasp` (patientid,labbillid,billdate,doctorname,centreid,centrename,itemid,itemname,itemtypeid,itemtype,patienttypeid,patienttype,channelid,channel,packagename,packageid,serviceid,servicetype,departmentid,department,entity_doctorname,doctorid,grossamount,netamount,discount,referalname,remarks,visittype,insurerparty,labname,ignoreitemamount, billingmetaid, bookinghash,encounterid) SELECT a.patientremoteid as patientid, a.bookingid AS labbillid, a.bookingdate AS billdate, --a.doctorname,
null as doctorname, CAST(c.id AS string) AS centreid, c.centrename as centrename, b.id AS itemid, b.testname AS itemname, b.itemtypeid, it.value as itemtype, a.patienttypeid, pt.value as patienttype, a.channelid, ch.value as channel, b.packagename, REPLACE(LOWER(TRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(b.packagename, ',', ';'), '{', ' '), '"', ''), '}', ''), ',', ''), "''", ''))), ' ', '') AS packageid, b.servicetypeid as serviceid, st.value as servicetype, a.departmentid, dep.value as department, d.name AS entity_doctorname, d.id AS doctorid, a.grossamount, a.netamount, a.discount, e.name AS referalname, a.remarks, a.visittype, 
--a.insurerparty,
null as insurerparty,  'testclient' as labname, a.ignoreitemamount,a.billingmetaid,a.bookinghash,a.encounterid from `sync_merged.items` a  LEFT JOIN `sync_merged.billingmeta` b ON a.billingmetaid = b.id LEFT JOIN `sync_constant.centres` c ON a.centreid = c.id left JOIN `sync_constant.entities` d ON a.entitydoctorid = d.id left JOIN `sync_constant.entities` e ON a.entityreferalid = e.id left join `sync_constant.patienttype` as pt on a.patienttypeid = pt.id left join `sync_constant.channel` as ch on a.channelid = ch.id left join `sync_constant.department` as dep on a.departmentid = dep.id left join `sync_constant.itemtype` as it on b.itemtypeid = it.id left join `sync_constant.servicetype` as st on b.servicetypeid = st.id;
