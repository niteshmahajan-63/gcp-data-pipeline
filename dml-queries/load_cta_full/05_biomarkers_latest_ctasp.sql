truncate table `sync_ctas.biomarkers_latest_ctasp`;

insert into `sync_ctas.biomarkers_latest_ctasp` (patientid, biomarkercode, testid, testname, bookingid,bookingdate,valued,latbookingdate,latvalued,labname,encounterid) SELECT patientid, biomarkercode, testid, testname, bookingid, resultdate as bookingdate, resultnum as valued, resultdate as latbookingdate, resultnum as latvalued, 'testclient' as labname,encounterid FROM ( SELECT patientid, biomarkercode, bookingid, testid, testname, resultdate, resultnum,encounterid, ROW_NUMBER() OVER (PARTITION BY patientid, biomarkercode ORDER BY resultdate DESC, resultnum DESC) AS rnk FROM ( SELECT a.patientremoteid as patientid, a.biomarkercode, a.bookingid, b.testid AS testid, b.testname AS testname, a.resultdate, a.resultnum,a.encounterid FROM `sync_merged.numeric` a JOIN `sync_merged.biomarkermeta` b ON a.biomarkermetaid = b.id) as tmp ) as tmp_1 WHERE rnk = 1;